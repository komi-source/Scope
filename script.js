const planetData = {
    // Вся подробная информация по планетам сохранена
    toi1203e: {
        name: "TOI-1203e",
        type: "Gas Giant",
        info: "TOI-1203 e is a confirmed gas giant exoplanet orbiting the distant star TOI-1203 in a remarkable planetary system of at least four known worlds. Located approximately 212 light-years from Earth, this system is notable for its incredible age and dynamic stability.",
        details: "The host star, TOI-1203, is a bright, yellow G3V-type star—similar to our Sun but slightly larger and older. At an estimated age of 12.5 billion years (Gyr), TOI-1203 is considered part of the ancient, alpha-element enhanced stellar population belonging to the Milky Way's thick disk. The four-planet system—comprising TOI-1203 b, c, d, and e—was discovered in 2025 through an intensive follow-up campaign utilizing the High Accuracy Radial velocity Planet Searcher (HARPS) spectrograph and the CHEOPS space telescope. TOI-1203 e, the outermost known planet, was detected using the Radial Velocity method, which measures the gravitational <wobble> the planet imparts on its star. Despite its complexity and age, a detailed stability analysis confirmed that the TOI-1203 system is dynamically stable over billion-year timescales. TOI-1203 e is classified as a gas giant, though its estimated radius approx 0.653 Jupiter radii suggests it's smaller than Jupiter. Minimum Mass - approx 42 Earth masses. Equivalent to approximately one-eighth the mass of Jupiter. Orbital Period - approx 204.6 days. Takes roughly 6.8 months to complete one trip around its star. Semi-Major Axis - approx 0.65 AU. Its orbit is slightly closer to its star than Venus is to the Sun approx 0.72 AU. Estimated Temperature 1075.0 K - approx 802 C. Its close orbit results in a very high equilibrium temperature, suggesting a hot, inhospitable environment. TOI-1203 e's substantial mass and eccentric, medium-period orbit make it a crucial component for understanding the overall dynamics and long-term evolution of this fascinating, ancient planetary system."
    },
    pegasiB: {
        name: "51 Pegasi b",
        type: "Hot Jupiter",
        info: "51 Pegasi b, officially named Dimidium, is arguably the most historically significant exoplanet ever discovered. It holds the distinction of being the first confirmed exoplanet found orbiting a normal, Sun-like star. Its groundbreaking discovery in 1995 not only launched the modern field of exoplanetary science but also completely upended existing theories of how planetary systems form.",
        details: "The planet orbits the star 51 Pegasi (also named Helvetios), a G-type star similar to our Sun, located approximately 50 light-years away in the constellation Pegasus. 51 Pegasi b was discovered by Swiss astronomers Michel Mayor and Didier Queloz, who would later be awarded the 2019 Nobel Prize in Physics for their work. The planet became the defining example of an entirely new class of worlds: the **Hot Jupiters**. The planet orbits its star at an astonishingly close distance of only 0.052 Astronomical Units, which is roughly 7.8 million kilometers. Due to its close proximity, 51 Pegasi b completes a full revolution around its star in a mere 4.23 earth days. Minimum Mass - about 0.47 times the mass of Jupiter. Its immense size is further inflated by the star’s heat, giving it a radius estimated to be about 1.2 times that of Jupiter. The intense stellar radiation from 51 Pegasi results in extreme conditions on the planet. Estimated Temperature 1,500 Kelvin (1,200 C or 2,200 F). The planet is believed to be **tidally locked** to its star, meaning one face is perpetually baked by the sun while the other remains in darkness. The discovery of 51 Pegasi b truly ushered in the Exoplanet Revolution, paving the way for the thousands of worlds that have been found since."
    },
    aurigaeB: {
        name: "AB Aurigae b",
        type: "Protoplanet",
        info: "AB Aurigae b is a colossal, newly forming gas giant, a protoplanet, which has provided astronomers with a rare, direct look at the chaotic process of planetary creation. It orbits the young, massive Herbig Ae/Be star AB Aurigae, located about 509 light-years from Earth.",
        details: "AB Aurigae b is a massive object. Minimum Mass - estimated to be between 9 and 12 times the mass of Jupiter, though some estimates go as high as 20. Its radius is approximately 2.75 times that of Jupiter. The protoplanet resides at an extraordinarily wide separation from its host star, approximately 93 Astronomical Units (AU), a distance more than double that between the Sun and Pluto. Its orbital period is immense, estimated at nearly 588 years. Estimated Temperature 2200 Kelvin. This vast distance is one of the most intriguing aspects of the system, as it strongly supports the **disk instability model** of planet formation, which contrasts sharply with the prevailing core accretion model. The planet's presence is thought to be responsible for the striking spiral arms observed within the disk, as its gravity perturbs and channels the surrounding material."
    },
    wasp12b: {
        name: "WASP-12b",
        type: "Hot Jupiter",
        info: "WASP-12b is one of the most extreme and fascinating exoplanets known, often described as a <doomed> hot Jupiter. Discovered in 2008 by the SuperWASP planetary survey.",
        details: "WASP-12b is a scorching, inflated gas giant. Minimum Mass - about 1.47 times the mass of Jupiter but an enormous radius of nearly twice that of Jupiter (1.9 R_J). It circles its parent star in just over one Earth day (1.09 days), putting it incredibly close—only about 3.5 million kilometers (0.023 AU) away. The dayside temperature is a blistering 2885 degrees Celsius (3128 K), making it one of the hottest known exoplanets. The planet reflects only about 6% of the light that strikes it, making it essentially **pitch black**—darker than fresh asphalt. The star’s gravity exerts immense tidal forces on the planet, distorting its shape into a pronounced prolate spheroid (like a rugby ball). The intense gravitational interaction has led to the confirmed phenomenon of **orbital decay**. Scientists predict that the planet will be completely consumed by its star in an astronomically brief period of approximately 3.2 million years."
    },
    gliese436b: {
        name: "Gliese 436 b (Awohali)",
        type: "Neptune-like",
        info: "Gliese 436 b is a remarkable exoplanet orbiting the faint red dwarf star Gliese 436. It gained international attention as the first confirmed example of a <Hot Neptune,> a class of planet with a mass and size comparable to Neptune but orbiting extremely close to its star.",
        details: "Awohali is slightly more massive and larger than Neptune. Minimum Mass - about 22 Earth masses. It has an incredibly tight orbit, completing one full revolution in just 2.64 Earth days. Estimated Temperature 712 K. One of the most surprising findings is the planet's **eccentric, misaligned path**. This suggests a violent past, possibly due to gravitational interactions with a yet-undetected outer companion. The planet is best known for two atmospheric anomalies: **Missing Methane** (the atmosphere showed an abundance of carbon monoxide CO and a dramatic deficiency of methane) and a **Giant Hydrogen Exosphere** detected by Hubble, forming a gigantic comet-like tail—dubbed <The Behemoth.> The extreme UV radiation from the star is actively stripping the planet's atmosphere."
    },
    hatp11b: {
        name: "HAT-P-11 b",
        type: "Neptune-like",
        info: "HAT-P-11 b, also known as Kepler-3b, is a significant <exo-Neptune,> a warm, gaseous planet with a mass and radius comparable to that of Neptune. Its importance was cemented by its location within the initial field of view of the revolutionary Kepler spacecraft.",
        details: "Minimum Mass - about 27 Earth masses. It whips around HAT-P-11 in a mere 4.9 days, at a distance of only about 0.05 Astronomical Units (AU). Estimated Temperature around 787 Kelvin. It holds the distinction of being the smallest exoplanet from which molecules of any kind were initially detected. Scientists have found that HAT-P-11 b is shrouded in a hydrogen-rich atmosphere that is blanketed with **water vapor**. Furthermore, observations have led to the detection of **helium, which is being stripped away** from the planet. Its orbit presents a major puzzle: astronomers determined that the planet's orbit is highly inclined, or **oblique**, relative to the equatorial plane of its host star (103 degrees tilt), suggesting a dramatic and turbulent history."
    },
    kepler1922b: {
        name: "Kepler-1922 b",
        type: "Neptune-like",
        info: "The Kepler-1922 system, located over 4,380 light-years away from Earth, offers a glimpse into the distant universe through the discovery of a single confirmed exoplanet, Kepler-1922 b.",
        details: "Based on its estimated mass and density, Kepler-1922 b is classified as an **ice giant**, a term suggesting it's composed mostly of volatiles such as water, ammonia, and methane. Minimum Mass - approx 15 Earth masses. The calculated temperature of 740 K means it is a <Hot Ice Giant,> likely having undergone significant photoevaporation of its atmosphere due to the intense stellar radiation. Orbital Period - approx 35.5 days. Its high density, nearly three times that of water, suggests a substantial solid or liquid interior, likely a rocky core surrounded by a thick envelope of compressed volatile compounds."
    },
    toi2768b: {
        name: "TOI-2768 b",
        type: "Neptune-like",
        info: "TOI-2768 b is a recently confirmed exoplanet that has captured scientific interest primarily because of where it is located: deep within the theoretical area of space known as the **Neptunian Desert**.",
        details: "TOI-2768 b is a Neptune-like or Mini-Neptune planet. Minimum Mass - 7.41 Earth masses. Orbital Period - 1.5 days. Semi-Major Axis - 0.027 Astronomical Units (AU), about 14 times closer to its star than Mercury is to the Sun. Equilibrium Temperature sim 855 K. The Neptunian Desert is a specific region close to stars where the intense stellar radiation causes the atmospheres of hydrogen- and helium-rich planets to completely photoevaporate. TOI-2768 b lies right on the edge of this barren region. Its existence provides a crucial data point for scientists, suggesting it may have survived atmospheric stripping in this 'forbidden zone' due to its density or youth."
    },
    proximaCentauriB: {
        name: "Proxima Centauri b",
        type: "Super-Earth",
        info: "Proxima Centauri b (or Proxima b) is an exoplanet orbiting Proxima Centauri, the closest star to our Sun, located just 4.2 light-years away. This world immediately became a focal point in the search for extraterrestrial life, as it is the closest known planet that resides within its star's habitable zone.",
        details: "Proxima b is classified as a **Super-Earth**—a planet with a mass higher than Earth's but substantially lower than that of the ice giants. Minimum Mass - approximately 1.2 Earth masses. Short Orbit - Proxima b orbits its star in just 11.2 Earth days. Tidal Locking: Its close proximity means it is likely **tidally locked**, resulting in one side permanently facing the star and the other in perpetual darkness. The most compelling aspect of Proxima b is its location in the habitable zone, where temperatures could allow for liquid water. However, its red dwarf host star is a **flare star** and subjects the planet to hundreds of times more high-energy radiation than Earth, posing a major challenge to sustained life and atmosphere retention."
    },

};

const detailsView = document.getElementById('details-view');
const screenList = document.getElementById('screen-list');
const screenDetails = document.getElementById('screen-details');
const backButton = document.getElementById('back-button');
const visualizationArea = document.getElementById('visualization-area');
const filterSelect = document.getElementById('filter-type');
const desertButton = document.getElementById('desert-button');
const sortButton = document.getElementById('sort-mass-button');
let currentSortOrder = 'desc'; 


function getPlanetColor(key) {
    switch (key) {
        case 'toi1203e': return '#ff9800'; 
        case 'pegasiB': return '#cc6d3d'; 
        case 'aurigaeB': return '#e0ac8f'; 
        case 'wasp12b': return '#111111'; 
        case 'gliese436b': return '#4b66ff'; 
        case 'hatp11b': return '#3b74b8'; 
        case 'kepler1922b': return '#8cffff'; 
        case 'toi2768b': return '#d1b87a'; 
        case 'proximaCentauriB': return '#d8453e'; 
        default: return '#fff';
    }
}
function extractDataForPlot(key) {
    const data = planetData[key].details;
    let mass = 1;
    let period = 10;
    
    let massMatchEarth = data.match(/Minimum Mass - approx ([\d\.]+) Earth masses/i) ||
                         data.match(/Minimum Mass - about ([\d\.]+) Earth masses/i) ||
                         data.match(/Minimum Mass - approximately ([\d\.]+) Earth masses/i) ||
                         data.match(/Minimum Mass - ([\d\.]+) Earth masses/i);
                         
    let massMatchJupiter = data.match(/mass of about ([\d\.]+) times the mass of Jupiter/i) ||
                           data.match(/estimated to be between ([\d\.]+) and/i); 

    if (massMatchEarth) {
        mass = parseFloat(massMatchEarth[1]);
    } else if (massMatchJupiter) {
        mass = parseFloat(massMatchJupiter[1]) * 317.8; 
    }

    let periodMatch = data.match(/Orbital Period - approx ([\d\.]+) days/i) ||
                      data.match(/revolution in just ([\d\.]+) Earth days/i) || 
                      data.match(/revolution around its star in a mere ([\d\.]+) earth days/i) || 
                      data.match(/Orbital Period - ([\d\.]+) days/i);
    if (periodMatch) {
        period = parseFloat(periodMatch[1]);
    }

    mass = Math.max(0.1, mass); 
    period = Math.max(1, period); 

    return {
        key: key,
        name: planetData[key].name,
        type: planetData[key].type,
        period: period, 
        mass: mass,     
        logPeriod: Math.log10(period),
        logMass: Math.log10(mass)
    };
}

const PLOT_DATA = Object.keys(planetData).map(key => extractDataForPlot(key));
const PLOT_WIDTH = 460; 
const PLOT_HEIGHT = 450;
const X_AXIS_LABEL_OFFSET = 40; 
const Y_AXIS_LABEL_OFFSET = 30; 
const CHART_TITLE_HEIGHT = 40; 


function renderPlot(filteredData = PLOT_DATA) {
    visualizationArea.style.width = PLOT_WIDTH + 'px';
    visualizationArea.style.height = PLOT_HEIGHT + 'px';
    visualizationArea.style.padding = '0'; 

    visualizationArea.querySelector('.plot-caption').remove(); 
    visualizationArea.innerHTML = `
        <div class="plot-caption">Exoplanet Mass ($M_\oplus$) vs. Orbital Period (days)</div>
        <div id="data-points-wrapper">
            <div id="neptunian-desert" class="${desertButton.classList.contains('active') ? 'visible' : ''}"></div>
            <div id="data-points"></div>
        </div>
    `;

    const dataPointsWrapper = document.getElementById('data-points-wrapper');
    const dataPointsContainer = document.getElementById('data-points');
    
    
    const innerWidth = PLOT_WIDTH - X_AXIS_LABEL_OFFSET - 10; 
    const innerHeight = PLOT_HEIGHT - CHART_TITLE_HEIGHT - Y_AXIS_LABEL_OFFSET - 10; 
    
    dataPointsWrapper.style.width = PLOT_WIDTH + 'px';
    dataPointsWrapper.style.height = PLOT_HEIGHT - CHART_TITLE_HEIGHT + 'px'; 
    dataPointsWrapper.style.position = 'relative';
    dataPointsWrapper.style.marginTop = CHART_TITLE_HEIGHT + 'px'; 

    dataPointsContainer.style.width = innerWidth + 'px';
    dataPointsContainer.style.height = innerHeight + 'px';
    dataPointsContainer.style.position = 'absolute';
    dataPointsContainer.style.left = X_AXIS_LABEL_OFFSET + 'px';
    dataPointsContainer.style.bottom = Y_AXIS_LABEL_OFFSET + 'px';
    dataPointsContainer.style.borderLeft = '2px solid #a0c4ff';
    dataPointsContainer.style.borderBottom = '2px solid #a0c4ff';

    const logPeriods = PLOT_DATA.map(d => d.logPeriod);
    const logMasses = PLOT_DATA.map(d => d.logMass);
    
    const minLogPeriod = Math.floor(Math.min(...logPeriods) * 10) / 10;
    const maxLogPeriod = Math.ceil(Math.max(...logPeriods) * 10) / 10;
    const minLogMass = Math.floor(Math.min(...logMasses) * 10) / 10;
    const maxLogMass = Math.ceil(Math.max(...logMasses) * 10) / 10;
    
    const xRange = maxLogPeriod - minLogPeriod;
    const yRange = maxLogMass - minLogMass;

    PLOT_DATA.forEach(d => {
        const xPos = ((d.logPeriod - minLogPeriod) / xRange) * innerWidth;
        const yPos = ((d.logMass - minLogMass) / yRange) * innerHeight;

        const point = document.createElement('div');
        point.className = 'plot-point';
        point.id = `point-${d.key}`;
        point.dataset.name = d.name;
        point.dataset.type = d.type.toLowerCase().replace(/\s/g, '_').replace(/-/g, '_');
        point.style.backgroundColor = getPlanetColor(d.key);
        point.style.left = xPos + 'px';
        point.style.bottom = yPos + 'px';
        
        if (!filteredData.some(fd => fd.key === d.key)) {
             point.style.opacity = 0.2;
        }

        dataPointsContainer.appendChild(point);
    });
    
    for (let i = 0; i <= 3; i++) { 
        const val = Math.pow(10, i);
        const logVal = i;
        if (logVal >= minLogPeriod && logVal <= maxLogPeriod + 0.1) { 
            const xPos = ((logVal - minLogPeriod) / xRange) * innerWidth;
            if (xPos >= 0 && xPos < innerWidth) {
                 const label = document.createElement('div');
                 label.className = 'axis-label x-label';
                 label.style.left = xPos + 'px';
                 label.innerText = val;
                 dataPointsContainer.appendChild(label);
            }
        }
    }

    for (let i = -1; i <= 3; i++) { 
        const val = Math.pow(10, i);
        const logVal = i;
        if (logVal >= minLogMass && logVal <= maxLogMass + 0.1) {
            const yPos = ((logVal - minLogMass) / yRange) * innerHeight;
            if (yPos >= 0 && yPos < innerHeight) {
                 const label = document.createElement('div');
                 label.className = 'axis-label y-label';
                 label.style.bottom = yPos + 'px';
                 label.innerText = val < 1 ? val.toFixed(1) : val.toFixed(0);
                 dataPointsContainer.appendChild(label);
            }
        }
    }
    
    renderNeptunianDesert(minLogPeriod, xRange, innerWidth, minLogMass, yRange, innerHeight);
}


function renderNeptunianDesert(minLogPeriod, xRange, innerWidth, minLogMass, yRange, innerHeight) {
    const desertElement = document.getElementById('neptunian-desert');
    if (!desertElement) return;

    const startPeriod = 1.5;
    const endPeriod = 4.0;
    const logStartPeriod = Math.log10(startPeriod);
    const logEndPeriod = Math.log10(endPeriod);
    
    const xStart = ((logStartPeriod - minLogPeriod) / xRange) * innerWidth;
    const xEnd = ((logEndPeriod - minLogPeriod) / xRange) * innerWidth;
    
    const startMass = 5.0; 
    const endMass = 30.0;  
    const logStartMass = Math.log10(startMass);
    const logEndMass = Math.log10(endMass);
    
    const yStart = ((logStartMass - minLogMass) / yRange) * innerHeight;
    const yEnd = ((logEndMass - minLogMass) / yRange) * innerHeight;
    
    desertElement.style.left = `${X_AXIS_LABEL_OFFSET + xStart}px`;
    desertElement.style.width = `${xEnd - xStart}px`;
    
    const bottomPos = Y_AXIS_LABEL_OFFSET + yStart;
    const height = yEnd - yStart;
    
    desertElement.style.bottom = `${bottomPos}px`;
    desertElement.style.height = `${height}px`;
}


// ----------------------------------------------------
// ЛОГИКА fucking Interface
// ----------------------------------------------------

function switchScreen(targetScreen) {
    if (targetScreen === 'details') {
        screenList.classList.remove('active-screen');
        screenDetails.classList.add('active-screen');
    } else { 
        screenDetails.classList.remove('active-screen');
        screenList.classList.add('active-screen');
        document.querySelectorAll('.plot-point').forEach(p => p.classList.remove('highlighted', 'active-label'));
        document.querySelectorAll('.planet-button').forEach(b => b.classList.remove('highlighted'));
    }
}


function updatePlanetInfo(objectKey) {
    const data = planetData[objectKey];
    
    if (data) {
        detailsView.innerHTML = `
            <h3>${data.name}</h3>
            <p><strong>Type:</strong> ${data.type}</p>
            <p><strong>Overview:</strong> ${data.info}</p>
            <p><strong>Detailed Data:</strong> ${data.details}</p>
        `;

        document.querySelectorAll('.plot-point').forEach(point => {
            point.classList.remove('highlighted', 'active-label');
        });
        document.querySelectorAll('.planet-button').forEach(button => {
             button.classList.remove('highlighted');
        });
        
        const activePoint = document.getElementById(`point-${objectKey}`);
        const activeButton = document.querySelector(`.planet-button[data-planet="${objectKey}"]`);
        
        if (activePoint) {
            activePoint.classList.add('highlighted', 'active-label');
            activePoint.setAttribute('data-label', data.name);
        }
        if (activeButton) {
             activeButton.classList.add('highlighted');
        }
        
        switchScreen('details');
    }
}


const planetButtons = document.querySelectorAll('.planet-button');
planetButtons.forEach(button => {
    button.addEventListener('click', (event) => {
        const selectedObject = event.currentTarget.dataset.planet;
        updatePlanetInfo(selectedObject);
    });
});

backButton.addEventListener('click', () => {
    switchScreen('list');
});


visualizationArea.addEventListener('click', (event) => {
    let target = event.target;
    if (target.classList.contains('plot-point')) {
        const objectKey = target.id.replace('point-', '');
        updatePlanetInfo(objectKey);
    }
});


filterSelect.addEventListener('change', () => {
    const selectedFilter = filterSelect.value;
    let filteredData = PLOT_DATA;
    
    if (selectedFilter !== 'all') {
        filteredData = PLOT_DATA.filter(d => {
            if (selectedFilter === 'other') {
                return d.type.toLowerCase().includes('protoplanet');
            }
            return d.type.toLowerCase().replace(/\s/g, '_') === selectedFilter;
        });
    }
    
    renderPlot(filteredData);
});


desertButton.addEventListener('click', () => {
    const desertElement = document.getElementById('neptunian-desert');
    if (desertElement) {
        desertElement.classList.toggle('visible');
        desertButton.classList.toggle('active');
    }
});


sortButton.addEventListener('click', () => {
    const buttonContainer = document.getElementById('planet-list');
    const currentButtons = Array.from(buttonContainer.children).filter(el => el.classList.contains('planet-button'));
    
    const sortableData = currentButtons.map(button => {
        const key = button.dataset.planet;
        return {
            key: key,
            mass: PLOT_DATA.find(d => d.key === key).mass,
            element: button
        };
    });
    
    if (currentSortOrder === 'desc') {
        sortableData.sort((a, b) => a.mass - b.mass);
        currentSortOrder = 'asc';
        sortButton.textContent = 'Sort List (Mass ↑)';
    } else {
        sortableData.sort((a, b) => b.mass - a.mass);
        currentSortOrder = 'desc';
        sortButton.textContent = 'Sort List (Mass ↓)';
    }
    
    sortableData.forEach(item => {
        buttonContainer.appendChild(item.element);
    });
});


window.addEventListener('load', () => {
    renderPlot(); 
});